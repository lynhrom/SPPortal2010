define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/on","dojo/mouse","custom/Rotator"],function(c,f,e,a,b,d){return c("custom.AutoRotator",d,{suspendOnHover:false,duration:4000,autoStart:true,pauseOnManualChange:false,cycles:-1,random:false,reverse:false,constructor:function(){var g=this;if(g.cycles-0==g.cycles&&g.cycles>0){g.cycles++}else{g.cycles=g.cycles?-1:0}g._signals=[a(g._domNode,b.enter,function(){if(g.suspendOnHover&&!g.anim&&!g.wfe){var h=g._endTime,i=g._now();g._suspended=true;g._resetTimer();g._resumeDuration=h>i?h-i:0.01}}),a(g._domNode,b.leave,function(){if(g.suspendOnHover&&!g.anim){g._suspended=false;if(g.playing&&!g.wfe){g.play(true)}}})];if(g.autoStart&&g.panes.length>1){g.play()}else{g.pause()}},destroy:function(){f.forEach(this._signals,function(g){g.remove()});delete this._signals;dojo.forEach(this._connects,dojo.disconnect);this.inherited(arguments)},play:function(i,g){this.playing=true;this._resetTimer();if(i!==true&&this.cycles>0){this.cycles--}if(this.cycles==0){this.pause()}else{if(!this._suspended){this.onUpdate("play");if(g){this._cycle()}else{var j=(this._resumeDuration||0)-0,h=(j>0?j:(this.panes[this.idx].duration||this.duration))-0;this._resumeDuration=0;this._endTime=this._now()+h;this._timer=setTimeout(e.hitch(this,"_cycle",false),h)}}}},pause:function(){this.playing=this._suspended=false;this.cycles=-1;this._resetTimer();this.onUpdate("pause")},_now:function(){return(new Date()).getTime()},_resetTimer:function(){clearTimeout(this._timer)},_cycle:function(k){var m=this,h=m.idx,g;if(m.random){do{g=Math.floor(Math.random()*m.panes.length+1)}while(g==h)}else{g=h+(m.reverse?-1:1)}var l=m.go(g);if(l){l.addCallback(function(i){m.onUpdate("cycle");if(m.playing){m.play(false,i)}})}},onManualChange:function(g){this.cycles=-1;if(g!="play"){this._resetTimer();if(this.pauseOnManualChange){this.pause()}}if(this.playing){this.play()}}})});